@* @model PermissionViewModel

<style>
    .required-label::after {
        content: " *";
        color: red;
    }
</style>
<div class="modal-header bg-primary">
    <h5 class="modal-title">@(Model?.IntPermissionId > 0 ? "Edit Permission" : "Create Permission")</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="card">
    <div class="card-body">
        <form id="createPermissionForm" asp-action="@(Model?.IntPermissionId > 0 ? "PermissionEdit" : "NewPermission")" asp-controller="Master" method="post">
            <div class="form-group mb-3">
                <label><strong>Role</strong></label>
                <select asp-for="RoleId" asp-items="ViewBag.Roles" class="form-control"></select>
            </div>
            <table class="table table-bordered table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>Module</th>
                        <th>Submodule</th>
                        <th>View</th>
                        <th>Add</th>
                        <th>Edit</th>
                        <th>Delete</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @for (int i = 0; i < Model.Permissions.Count; i++)
                    {
                        <tr>
                            <td>
                                @Html.HiddenFor(m => m.Permissions[i].Module)
                                @Model.Permissions[i].Module
                            </td>
                            <td>
                                @Html.HiddenFor(m => m.Permissions[i].SubModule)
                                @Model.Permissions[i].SubModule
                            </td>
                            <td>@Html.CheckBoxFor(m => m.Permissions[i].View)</td>
                            <td>@Html.CheckBoxFor(m => m.Permissions[i].Add)</td>
                            <td>@Html.CheckBoxFor(m => m.Permissions[i].Edit)</td>
                            <td>@Html.CheckBoxFor(m => m.Permissions[i].Delete)</td>
                            <td>@Html.CheckBoxFor(m => m.Permissions[i].Status)</td>
                        </tr>
                    }
                </tbody>
            </table>
            <button type="submit" class="btn btn-success">Save Permissions</button>
        </form>
        </div>
        </div>

@section Scripts {
            <script>
                const subModuleData = @Html.Raw(Json.Serialize(ViewBag.SubModules));

                $('#ModuleSelect').on('change', function () {
                    const selectedModule = $(this).val();
                    const subModules = subModuleData[selectedModule] || [];

                    let options = '';
                    subModules.forEach(function (sub) {
                        options += `<option value="${sub}">${sub}</option>`;
                    });

                    $('#SubModuleSelect').html(options);
                });

                // Initial trigger
                $('#ModuleSelect').trigger('change');
            </script>
}
 *@